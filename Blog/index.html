<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog — The Skeen Advantage</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui, -apple-system, sans-serif;background:#0f1724;color:#e6eef3;margin:0;padding:30px}
    a{color:#7ce7c8}
    .container{max-width:900px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .post-list{margin-top:10px}
    .post-item{padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:10px}
    .post-content{padding:16px;background:rgba(255,255,255,0.01);border-radius:10px}
    .back{display:inline-block;margin-bottom:12px}
    pre{background:#071022;padding:12px;border-radius:6px;overflow:auto}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>The Skeen Advantage — Blog</h1>
      <nav><a href="/">Home</a></nav>
    </header>

    <div id="list-area">
      <p style="color:#9aa4b2">Weekly thoughts on security, cloud, and secure engineering.</p>
      <div id="posts" class="post-list">Loading posts…</div>
    </div>

    <div id="post-area" style="display:none">
      <a class="back" href="#" id="back-link">← Back to posts</a>
      <div id="post" class="post-content"></div>
    </div>
  </div>

  <!-- small, widely-used markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    async function loadIndex(){
      try{
        const res = await fetch('posts/index.json', {cache:'no-store'});
        const list = res.ok ? await res.json() : [];
        const postsEl = document.getElementById('posts');
        postsEl.innerHTML = '';
        if(!list.length){ postsEl.textContent = 'No posts yet. Add markdown files to /blog/posts/ and update index.json.'; return; }
        list.forEach(p => {
          const el = document.createElement('div');
          el.className = 'post-item';
          el.innerHTML = `<a href="?post=${encodeURIComponent(p.slug)}" style="font-weight:700">${p.title}</a>
                          <div style="color:#9aa4b2;font-size:13px">${p.date}</div>
                          <div style="margin-top:6px;color:#9aa4b2">${p.excerpt || ''}</div>`;
          postsEl.appendChild(el);
        });
      }catch(e){
        document.getElementById('posts').textContent = 'Failed to load posts.';
      }
    }

    async function loadPost(slug){
      try{
        const path = `posts/${slug}.md`;
        const res = await fetch(path, {cache:'no-store'});
        if(!res.ok) { history.replaceState({},'', '/blog/'); return loadIndexView(); }
        const md = await res.text();
        document.getElementById('post').innerHTML = marked.parse(md);
        document.getElementById('list-area').style.display = 'none';
        document.getElementById('post-area').style.display = 'block';
      }catch(e){
        document.getElementById('post').innerHTML = '<p>Unable to load post.</p>';
      }
    }

    function loadIndexView(){
      document.getElementById('list-area').style.display = 'block';
      document.getElementById('post-area').style.display = 'none';
      loadIndex();
    }

    document.getElementById('back-link').addEventListener('click', (e)=>{
      e.preventDefault();
      history.pushState({},'', '/blog/');
      loadIndexView();
    });

    // handle query param ?post=slug
    const params = new URLSearchParams(location.search);
    const post = params.get('post');
    if(post){
      loadPost(post);
    } else {
      loadIndex();
    }
    // support back/forward navigation
    window.addEventListener('popstate', ()=> {
      const p = new URLSearchParams(location.search).get('post');
      if(p) loadPost(p); else loadIndexView();
    });
  </script>
</body>
</html>